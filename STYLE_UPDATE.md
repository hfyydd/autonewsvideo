# 卡片样式和字幕功能更新

## ✨ 更新内容

### 1. 全新卡片样式设计

参照提供的设计图，重新设计了卡片样式：

#### 🎨 设计特点

- **纯白卡片背景**：更加清爽干净
- **彩色粗边框**：6px宽度，醒目但不夸张
- **左上角图标**：每种风格配有独特的Emoji图标
- **浅灰画布背景**：RGB(245, 245, 250)
- **圆角设计**：20px圆角，更加现代

#### 🌈 四种风格

| 风格 | 边框颜色 | 图标 | 用途 |
|-----|---------|------|-----|
| **Blue** | 亮蓝色 RGB(64, 169, 255) | 💬 | 对话/沟通类 |
| **Pink** | 粉色 RGB(255, 105, 180) | 🚩 | 重点/标记类 |
| **Green** | 绿色 RGB(120, 220, 120) | 🔧 | 技术/工具类 |
| **Purple** | 紫色 RGB(147, 112, 219) | 📊 | 数据/分析类 |

#### 📐 布局改进

```
┌─────────────────────────────────────┐
│ 🟦 [图标]                           │ ← 左上角图标（60x60圆角方块）
│                                     │
│         新闻标题                     │ ← 居中、加粗
│     ───────────────                 │ ← 彩色分隔线
│                                     │
│  ● 要点一                           │ ← 彩色圆点
│  ● 要点二                           │
│  ● 要点三                           │
│                                     │
│ 来源: XX        2024-11-08          │ ← 底部元信息
└─────────────────────────────────────┘
  ↑ 6px彩色边框
```

---

### 2. 视频字幕功能

#### ✅ 功能特点

- **自动添加字幕**：视频生成时自动添加
- **基于TTS文案**：使用播报文案生成字幕
- **半透明背景**：黑色半透明，确保可读性
- **智能截断**：字幕过长自动截断（100字）
- **可配置关闭**：通过配置文件控制

#### ⚙️ 字幕配置

```python
SUBTITLE_CONFIG = {
    "enabled": True,           # 是否启用字幕
    "font_size": 48,          # 字体大小
    "font_color": "white",    # 白色文字
    "bg_color": "black@0.6",  # 半透明黑色背景
    "position": "bottom",     # 底部居中
    "margin": 80,             # 距离底部80px
    "max_width": 1600,        # 最大宽度1600px
}
```

#### 📍 字幕位置

```
┌────────────────────────────┐
│                            │
│     新闻卡片图片            │
│                            │
│                            │
├────────────────────────────┤
│  ████████████████████      │ ← 80px margin
│  █  TTS播报文案字幕  █     │ ← 半透明背景
│  ████████████████████      │
└────────────────────────────┘
```

---

## 🎯 使用方法

### 关闭字幕

如果不需要字幕，修改 `config.py`：

```python
SUBTITLE_CONFIG = {
    "enabled": False,  # 改为 False
    ...
}
```

### 调整字幕样式

```python
SUBTITLE_CONFIG = {
    "font_size": 56,          # 更大的字体
    "font_color": "yellow",   # 黄色字幕
    "margin": 100,            # 距离底部更远
    ...
}
```

---

## 🔧 技术实现

### 卡片样式

**文件**: `services/image_generator.py`

主要改进：
1. 更粗的边框（6px）
2. 添加图标背景圆角方块
3. 使用Emoji图标
4. 优化配色方案

```python
# 绘制图标背景
draw.rounded_rectangle(
    [card_x + 25, card_y + 25,
     card_x + 85, card_y + 85],
    radius=12,
    fill=colors["border"]  # 使用主题色
)

# 绘制Emoji图标
draw.text(
    (card_x + 55, card_y + 55),
    colors["icon"],  # 💬, 🚩, 🔧, 📊
    font=icon_font,
    fill=(255, 255, 255)
)
```

### 字幕功能

**文件**: `services/video_composer.py`

使用MoviePy的TextClip和CompositeVideoClip：

```python
# 创建字幕
subtitle_clip = TextClip(
    text=news.tts_script[:100],
    font_size=48,
    color="white",
    bg_color="black@0.6",
    size=(1600, None),
    method='caption',
    duration=news.duration
)

# 合成到视频
img_clip = CompositeVideoClip([img_clip, subtitle_clip])
```

---

## 💡 设计理念

### 参考图片分析

从提供的VS Code设计图中提取的设计元素：

1. **简洁**：白色背景，清爽干净
2. **彩色边框**：使用鲜明的主题色
3. **图标点缀**：左上角小图标增加视觉趣味
4. **层次分明**：标题、正文、元信息清晰分级

### 适配调整

- **Emoji图标**：代替原图中的代码图标，更通用
- **颜色选择**：选用明亮但不刺眼的颜色
- **字体层次**：保持清晰的视觉层次
- **间距优化**：给图标留出呼吸空间

---

## 📊 对比

### 旧版本 vs 新版本

| 特性 | 旧版本 | 新版本 |
|-----|-------|-------|
| 边框宽度 | 8px | 6px（更精致） |
| 边框颜色 | 深色系 | 亮色系（更醒目） |
| 背景色 | 彩色渐变 | 纯白（更清爽） |
| 画布色 | 彩色 | 浅灰（更统一） |
| 图标 | 无 | 左上角Emoji |
| 圆角 | 25px | 20px |
| 字幕 | 无 | 支持 |

---

## 🎬 字幕效果预览

```
┌──────────────────────────────────────┐
│                                      │
│    💬  VS Code 内联补全功能开源      │
│    ────────────────────────          │
│                                      │
│    ● AI 编辑器功能开源               │
│    ● 继续改进内联补全                │
│    ● 开发者可关注最新迭代            │
│                                      │
│    来源: 科技新闻    2024-11-08      │
│                                      │
├──────────────────────────────────────┤
│  ████████████████████████████        │
│  █ 微软 VS Code 团队宣布...    █     │ ← 字幕
│  ████████████████████████████        │
└──────────────────────────────────────┘
```

---

## ⚠️ 注意事项

### 字幕显示

1. **字幕长度**：自动截断为100字，避免过长
2. **字体要求**：需要系统支持中文字体
3. **性能影响**：添加字幕会略微增加渲染时间

### 卡片样式

1. **图标显示**：部分系统可能不支持Emoji显示
2. **字体回退**：无中文字体时图标可能显示异常
3. **颜色一致性**：确保各平台显示效果一致

---

## 🔄 回退方案

如果新样式有问题，可以恢复旧配色：

```python
CARD_STYLES = {
    "blue": {
        "bg": (240, 244, 248),
        "card_bg": (255, 255, 255),
        "border": (100, 150, 255),
        "accent": (100, 150, 255),
        "title_color": (30, 30, 50),
        "text_color": (60, 60, 80),
        "meta_color": (150, 150, 150),
        # 不包含 "icon" 字段
    },
}
```

---

## 📝 相关文档

- [WORKFLOW_UPDATE.md](WORKFLOW_UPDATE.md) - 工作流程说明
- [CONTENT_SEPARATION.md](CONTENT_SEPARATION.md) - 内容分离设计
- [BUGFIX.md](BUGFIX.md) - 问题修复记录
- [README.md](README.md) - 项目说明
